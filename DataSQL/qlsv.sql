CREATE DATABASE QLSV
go
use QLSV 
go
create table MONHOC(
	MAMH char(10) not null,
	TENMH nvarchar(50) not null, SOTIET numeric(18,0)
	Constraint MONHOC_MAMH_pk primary key(MAMH))
	
go
Create table KHOA(
	MAKHOA char(10) primary key,
	TENKHOA nvarchar(50)not null,)
go
Create table SINHVIEN(
	MASV char(10) not null primary key,
	HOSV nvarchar(50) not null,
	TENSV nvarchar(50) not null,
	PHAI nvarchar(5),
	NS nvarchar(30) not null,
	MAKHOA char(10) not null,
	Constraint  fk_MAKHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA))

	ALTER TABLE SINHVIEN
	DROP CONSTRAINT [fk_MAKHOA]
go
Create table KETQUA(
	MASV char(10) not null,
	MAMH char(10) not null,
	LANTHI int,
	DIEM decimal(4,2),
	Constraint KETQUA_MASV_MAMH_LANTHI_pk primary key(MASV,MAMH,LANTHI),
	Constraint  fk_KETQUA FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
	constraint fk_MAMH foreign key(MAMH) references MONHOC(MAMH)
	on delete cascade
	on update cascade)
go
use QLSV 
go
drop table SINHVIEN



INSERT INTO KHOA(MAKHOA,TENKHOA) VALUES('ANVAN', 'Khoa Anh Văn')
INSERT INTO KHOA(MAKHOA,TENKHOA) VALUES('CNTT', 'Khoa Cong nghe thong tin')
INSERT INTO KHOA(MAKHOA,TENKHOA) VALUES('DTVT', 'Khoa Dien tu vien thong')
INSERT INTO KHOA(MAKHOA,TENKHOA) VALUES('QTKD', 'Khoa Quan tri Kinh Doanh')
go
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('AV', 'Anh van','45')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('CSDL', 'Co So Du lieu','45')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('KTLT', 'Ky Thuat Lap Trinh','60')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('KTTC', 'Ke Toan Tai Chinh','45')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('TCC', 'Toan Cao cap','60')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('THVP', 'Tin Van Phong','30')
INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES('TTNT', 'Tri Tue Nhan Tao','60')
go
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S001','Nguyen Van','An','10/21/1985','Nam','CNTT')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S002','Dinh Van','Hoa','01/15/1984','Nam','CNTT')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S003','Ngo Viet','Hung','12/15/1986','Nam','DTVT')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S004','Nguyen Thi','Hong','2/12/1986','Nu','QTKD')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S005','La Thi','Lan','08/03/1985','Nu','ANVAN')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S006','Nguyen Minh','Hien','11/1/1984','Nu','ANVAN')
INSERT INTO SINHVIEN(MASV,HOSV,TENSV,NS,PHAI,MAKHOA) VALUES('S007','Pham Ngoc','Doan','10/10/1986','Nam','DTVT')
go
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S001','TCC','1','6')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S002','CSDL','1','3')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S002','CSDL','2','6')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S003','KTTC','1','5')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S004','AV','1','8')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S004','THVP','1','4')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S004','THVP','2','8')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S005','THVP','1','6')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S006','AV','1','4')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S006','AV','2','8')
INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES('S007','KTLT','1','9')


update SINHVIEN 

set TENSV = 'Loi',HOSV = 'Nguyen Van'
where MASV = 'S001';

SELECT CONCAT(HOSV,' ',TENSV) AS HOVATEN  
FROM SINHVIEN


SELECT SINHVIEN.MASV,HOSV,TENSV,DIEM
FROM SINHVIEN JOIN KETQUA
ON SINHVIEN.MASV = KETQUA.MASV

SELECT *FROM KETQUA
go
SELECT * FROM SINHVIEN
go
SELECT * FROM KHOA
SELECT *FROM MONHOC

alter table KETQUA
ADD CONSTRAINT fk_KETQUA FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV)


DELETE FROM SINHVIEN
WHERE MASV ='S001'

select * from KETQUA JOIN KETQUA
ON SINHVIEN.MASV = KETQUA.MASV
WHERE sinhvien.MASV = 'S001'




